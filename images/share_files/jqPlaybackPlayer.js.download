function GetAnalyzeScript(e){return null==e?[]:"undefined"!=typeof e.meta?e.data:e}function RenderPlayer(e,a,r,t){if(projectHeight=parseInt(e.height),projectWidth=parseInt(e.width),deviceHeight=parseInt(e.height),deviceWidth=parseInt(e.width),currentScreenIndex=r,device=e.device,void 0!=a.meta){for(var o=e,s=[],n=0;n<a.meta.length;n++){for(var l=a.meta[n],i={header:{h:l.hh},body:{h:l.sh},footer:{h:l.fh},timer:{screen:0,time:0,trans:""},anchors:[],layers:[]},p=0;p<l.l.length;p++){var d=l.l[p],y={id:d.id,link:0,image:d.i,back:d.bd,anchors:[],trans:d.trans,h:d.h,w:d.w,y:d.t,x:d.l};i.layers.push(y)}s.push({Title:"",action_file:"",script:{canvas:i},commentMarkerArray:[],created:"",id:l.id,image:l.i,modified:"",status_indicator:"",workflow_status:0})}o.screensArray=s,project=o,UserJourney=a.data.slice()}else project=e,UserJourney=a.slice();BuildPlayerControls(),PlaybackInit(function(){PlayerPlay(0)}),"free"==project.plan_type&&$("#upgradeWrapper").show()}function PlaybackUserBehaviour(e){if(time=e,!(UserJourney.length<1)){if(clearInterval(apTimer),apTimer=null,apArray=UserJourney.slice(),apArray[0][0]>1)for(var a=apArray[0][0]-1,r=0;r<apArray.length;r++)apArray[r][0]-=a;for(;apArray.length>0&&apArray[0][0]<time;)apArray.shift();if(0!=apArray.length){totalTime=Math.ceil(apArray[apArray.length-1][0]),currentScreenId=apArray[0][1],LoadPreviewScreen("",!1,0);var t=$(window.parent.document.getElementsByClassName("notes-add-comment-box"));t.find(".notes-playback-duration").text(" / "+getTimeFormat(totalTime)),$("#divTouch").remove(),$("#divCanvasContainer").append('<div id="divTouch"></div>'),touchObj=$("#divTouch"),setTouchPointer(touchObj,apArray[0]),RenderUserBehaviourFrame()}}}function RenderUserBehaviourFrame(){if(0==apArray.length)return clearInterval(apTimer),void(apTimer=null);var e=1e3*(apArray[0][0]-time);time=apArray[0][0],apTimer=window.setTimeout(function(){var e=apArray[0];if(e.length>6&&(""!=e[9]?"scroll"!=e[9]&&"hover"!=e[2]&&"mouseleave"!=e[2]&&4!=e[10]?touchObj.on(animEndEventName,function(){ExecuteGesture(e[9],e[7],e[7],e[8],e[12],e[13],e[3],e[4]),touchObj.off(animEndEventName).css({"-webkit-animation":"",animation:""})}).css({"-webkit-animation":e[2]+" .2s ease-in",animation:e[2]+" .2s ease-in"}):ExecuteGesture(e[9],e[7],e[7],e[8],e[12],e[13],e[3],e[4]):touchObj.on(animEndEventName,function(){touchObj.off(animEndEventName).css({"-webkit-animation":"",animation:""})}).css({"-webkit-animation":e[2]+"-miss .2s ease-in",animation:e[2]+"-miss .2s ease-in"})),apArray.length>1){var a=apArray[1],r=a[0]-time;r=r>.6?r-.6:r,window.setTimeout(function(){setTouchPointer(touchObj,a)},1e3*r)}apArray.shift(),RenderUserBehaviourFrame()},e)}function PlayerPause(){clearInterval(apTimer),apTimer=null,clearInterval(playerControlsTimer),playerControlsTimer=null}function setTouchPointer(e,a){if("scroll"!=a[9]&&4!=a[10]){var r=a[3],t=a[4],o=$(".clsCanvas[data-index='"+currentScreenIndex+"']");switch(a[10]){case 0:r=a[3],t=a[4];break;case 1:var s=o.data("scroll");r=a[3]+s.x/scaleFactor,t=a[4]+s.y/scaleFactor;break;case 2:var n=o.find(".fixedFooterImage").height()-o.height();r=a[3],t=a[4]-n/scaleFactor;break;case 3:var l=o.find(".layerElement.active");r=a[3]+parseInt(l.css("left"))/scaleFactor,t=a[4]+parseInt(l.css("top"))/scaleFactor;break;case 4:}e.css({left:r*scaleFactor,top:t*scaleFactor})}}function PlayerPlay(e){playerControlsProgressTime=Math.floor(e),PlaybackUserBehaviour(e),clearInterval(playerControlsTimer),playerControlsTimer=null,PlayerPlayInterval(),playerControlsTimer=window.setInterval(function(){PlayerPlayInterval()},100)}function PlayerPlayInterval(){if(playerControlsProgressTime<=totalTime){playerControlsProgressTime=parseFloat(parseFloat(playerControlsProgressTime+.1).toFixed(1));var e=playerControlsProgressTime/totalTime*playerControlsProgress.width();playerControlsProgressBar.width(e),playerControlsProgressHead.css("left",e-5),playerControlsTime.text(getTimeFormat(playerControlsProgressTime)+" / "+getTimeFormat(totalTime))}else clearInterval(playerControlsTimer),playerControlsTimer=null,playerControlsPlayPause.removeClass("svg-play svg-pause").addClass("svg-undo").html('<path d="M0 0h24v24H0z" fill="none"/><path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"/>')}function getTimeFormat(e){e=Math.floor(e);var a=parseInt(e/60),r=e%60;return a+":"+(r<10?"0"+r:r)}function BuildPlayerControls(){playerControlsProgress.width($("#playerControls").width()-170),playerControlsProgressBar.width(0),playerControlsPlayPause.removeClass("svg-play svg-undo").addClass("svg-pause").html('<path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/><path d="M0 0h24v24H0z" fill="none"/>')}function renderAddNotes(){var e='<div id="playerControlsAddNotes">Add Annotations @ <span></span></div>';$("#playerControlsProgress").append(e)}$(document).ready(function(){if(mode=getParameterByName("mode"),activeScreenTimer=null,projectId=null,currentScreenId=0,project={},duration="",userTaskId=0,isTestMode=!1,isHintEnable=!0,isAutoStretch=!1,scaleFactor=1,isCommentMode=!1,isCommentEnabled=!1,isRecordingEnabled=!1,startRecording=!1,isPlaybackPlayer=!0,swipeNavigationEnabled=!1,playbackPadding={top:5,bottom:50,left:0,right:0},screensVisited=[],screensInteracted=0,userJourneyInterval=0,userJourneyIntervalID=0,previousScreenId=0,screenTitle="",UserJourney=[],apArray=[],apTimer=null,time=0,totalTime=0,IdentifyPlatform(),browser=isMobile.device()+": "+browserName+" "+browserFullVersion,currentScreenId=getParameterByName("screenId"),projectId=getParameterByName("project"),playerMode=getParameterByName("mode"),shareId=getParameterByName("id"),taskId=getParameterByName("tid"),sharePlayRef=getParameterByName("ref"),isHeader=!1,playbackMessage=$("#playbackMessage"),divCanvasWrapper=$("#divCanvasWrapper"),playbackWrapper=$("#playbackWrapper"),divCanvasContainer=$("#divCanvasContainer"),createCommentMarkerDOM=$("#createCommentMarker"),playerControlsProgress=$("#playerControlsProgress"),playerControlsProgressBar=$("#playerControlsProgressBar"),playerControlsProgressHead=$("#playerControlsProgressHead"),playerControlsPlayPause=$("#playerControlsPlayPause > svg"),playerControlsTime=$("#playerControlsTime"),playerControlsTimer=null,playerControlsProgressTime=0,void 0!=analyzeDataRaw&&void 0!=projectDataRaw&&(analyzeDataRaw=analyzeDataRaw.replace(new RegExp("\n","g"),"\\n"),projectDataRaw=projectDataRaw.replace(new RegExp("\n","g"),"\\n"),analyzeDataRaw=JSON.parse(analyzeDataRaw),projectDataRaw=JSON.parse(projectDataRaw),null!=analyzeDataRaw)){var e=GetAnalyzeScript(analyzeDataRaw.script);if(e.length>0)if(taskId.length>0){for(var a=[],r=0;r<e.length;r++)e[r].length>6?taskId==e[r][11]&&a.push(e[r]):taskId==e[r][5]&&a.push(e[r]);"undefined"!=typeof analyzeDataRaw.script.meta?analyzeDataRaw.script.data=a:analyzeDataRaw.script=a,RenderPlayer(projectDataRaw,analyzeDataRaw.script,0,analyzeDataRaw)}else RenderPlayer(projectDataRaw,analyzeDataRaw.script,0,analyzeDataRaw);else alertify.error("User share video  can't be played now")}$("#playerControlsPlayPause").click(function(){playerControlsPlayPause.hasClass("svg-undo")?(playerControlsPlayPause.removeClass("svg-play svg-undo").addClass("svg-pause").html('<path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/><path d="M0 0h24v24H0z" fill="none"/>'),PlayerPlay(0)):playerControlsPlayPause.hasClass("svg-play")?(playerControlsPlayPause.removeClass("svg-play svg-undo").addClass("svg-pause").html('<path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/><path d="M0 0h24v24H0z" fill="none"/>'),PlayerPlay(time)):(playerControlsPlayPause.removeClass("svg-pause svg-undo").addClass("svg-play").html('<path d="M8 5v14l11-7z"></path><path d="M0 0h24v24H0z" fill="none"></path>'),PlayerPause(),clearInterval(playerControlsTimer),playerControlsTimer=null)}),playerControlsProgress.on("click",function(e){var a=e.clientX-playerControlsProgress.get(0).getBoundingClientRect().left;a=a/playerControlsProgress.width()*totalTime,PlayerPlay(a)}),$(".btn.btn-primary,.badge").on("click",function(){"none"!==$(".upgrade-message").css("display")?($("#upgradeWrapper > .badge").fadeIn("fast"),$(".upgrade-message").slideToggle("fast")):($("#upgradeWrapper > .badge").fadeOut("fast"),$(".upgrade-message").slideToggle("fast"))}),playerControlsProgress.on("mousemove",function(e){var a=e.pageX-$(this).offset().left;$("#playerControlsAddNotes").css({left:a-100}).show();var r=parseInt(a/playerControlsProgress.width()*totalTime);(r<0||r>totalTime)&&$("#playerControlsAddNotes").hide(),$("#playerControlsAddNotes").find("span").text(getTimeFormat(r))}),playerControlsProgress.on("mouseout",function(){$("#playerControlsAddNotes").hide()}),playerControlsProgress.on("click","#playerControlsAddNotes",function(e){e.stopPropagation();var a=e.pageX-playerControlsProgress.offset().left,r=parseInt(a/playerControlsProgress.width()*totalTime);PlayerPlay(r),PlayerPause(),playerControlsPlayPause.removeClass("svg-pause svg-undo").addClass("svg-play").html('<path d="M8 5v14l11-7z"></path><path d="M0 0h24v24H0z" fill="none"></path>');var t=$(window.parent.document.getElementById("analyzeScreenflowLeftNavbar"));t.find("li[data-tab='#notes']").trigger("click");var o=$(window.parent.document.getElementsByClassName("notes-add-comment-box"));o.find(".notes-add-comment-content").focus(),o.find(".notes-playback-timestamp").text($("#playerControlsAddNotes").find("span").text()),o.find(".notes-playback-duration").text(" / "+getTimeFormat(totalTime))})});