function InitiatePlayback(e,a,t){userJourneyUUID="",playbackInitConfirmed=!1,screensVisited=[],screensInteracted=0,userJourneyInterval=0,userJourneyIntervalID=0,isUserJourneyDirty=!1,duration="",currentScreenIndex=a,screenTitle="",project=e,isHintEnable=1==e.is_hint_enable,isAutoStretch=1==e.is_auto_stretch,isCommentEnabled=1==project.is_comment,isRecordingEnabled=!1,DeactivateScreenTimer(),null!=project.device_id&&(projectHeight=parseInt(project.height),projectWidth=parseInt(project.width),deviceHeight=parseInt(project.height),deviceWidth=parseInt(project.width),device=project.device),"preview"!=mode&&"review"!=mode&&(isRecordingEnabled="record"==project.access_level),isCommentEnabled&&(Comment=new CommentBox,Comment.init($("#useremail").val())),isInteractionModeActive&&$("li[data-option='sitemap']","#playbackHeader").trigger("click"),"free"==project.plan_type&&$("#upgradeWrapper").show(),PlaybackInit(t)}function PlaybackInit(e){var a=$("#optionsModal").remove(),t=$("#anonymousUserModal"),n=$("#playbackCommentClose").remove(),i=$("#playbackCommentInstructor").remove(),r=$("#playbackComment").remove(),o=$("#chatHeadWrapper").remove();if(t.length>0&&t.remove(),$("#divCanvasContainer").remove(),$("#divDeviceContainer").remove(),$("#divCanvasContainerHeader").remove(),$("#divCanvasContainerFooter").remove(),"owner"==project.access_level&&swipeNavigationEnabled||$(".playback-nav-buttons").hide(),isMobile.any())"undefined"!=typeof window.orientation&&(window.innerHeight<window.innerWidth?0!=window.orientation&&180!=window.orientation||(orientationOffset=-90):90!=window.orientation&&window.orientation!=-90||(orientationOffset=90)),divCanvasWrapper.append('<div id="divCanvasContainer"></div>'),playbackWrapper.addClass("no-skin"),"Desktop (Web)"!=device&&"Desktop Widescreen (Web)"!=device||playbackWrapper.addClass("website");else{var s="Landscape"==project.orientation?"landscape":"";switch(device){case"Android Phone":divCanvasWrapper.append('<div id="divDeviceContainer" class="device-android-nexus5 '+s+'"><div class="screen"><div id="divCanvasContainer"></div></div></div>');break;case"Android Tablet":divCanvasWrapper.append('<div id="divDeviceContainer" class="device-android-tab-nexus7 '+s+'"><div class="screen"><div id="divCanvasContainer"></div></div></div>');break;case"iPhone 6":divCanvasWrapper.append('<div id="divDeviceContainer" class="device-iphone6-gold '+s+'"><div class="screen"><div id="divCanvasContainer"></div></div></div>');break;case"iPhone 6 Plus":divCanvasWrapper.append('<div id="divDeviceContainer" class="device-iphone6plus-gold '+s+'"><div class="screen"><div id="divCanvasContainer"></div></div></div>');break;case"iPhone 5":divCanvasWrapper.append('<div id="divDeviceContainer" class="device-iphone5s-gold '+s+'"><div class="screen"><div id="divCanvasContainer"></div></div></div>');break;case"iPad":divCanvasWrapper.append('<div id="divDeviceContainer" class="device-ipadair2-gold '+s+'"><div class="screen"><div id="divCanvasContainer"></div></div></div>');break;case"Windows Phone":divCanvasWrapper.append('<div id="divDeviceContainer" class="device-lumia650-blue '+s+'"><div class="screen"><div id="divCanvasContainer"></div></div></div>');break;case"Apple Watch":divCanvasWrapper.append('<div id="divDeviceContainer" class="device-apple-watch '+s+'"><div class="screen"><div id="divCanvasContainer"></div></div></div>');break;case"Desktop (Web)":case"Desktop Widescreen (Web)":default:divCanvasWrapper.append("<div id='divCanvasContainerHeader'><div></div></div><div id='divCanvasContainerFooter'><div></div></div><div id='divCanvasContainer'></div>"),isWeb=!0,playbackWrapper.addClass("no-skin website"),divCanvasContainerHeader=$("#divCanvasContainerHeader"),divCanvasContainerFooter=$("#divCanvasContainerFooter"),divCanvasContainerHeaderImage=$("#divCanvasContainerHeader>div"),divCanvasContainerFooterImage=$("#divCanvasContainerFooter>div"),$("#playbackSidebar li[data-target='#qrCodeModal']").hide(),$(".playback-nav-buttons").addClass("web"),$(".playback-screen-count").addClass("web")}"Landscape"===project.orientation&&($(".playback-nav-buttons").addClass("landscape"),$(".playback-screen-count").addClass("landscape")),isHeader&&($("#playbackHeader").show(),"design"==playbackSource||"specs"==playbackSource?(playbackPadding.left=60,$("#playbackHeader").removeClass("inactive").show()):(playbackPadding.left=0,$("#playbackHeader").addClass("inactive").show()))}if(divCanvasContainer=$("#divCanvasContainer"),divDeviceContainer=$("#divDeviceContainer"),$("#bodySpinner").hide(),document.title="CanvasFlip - "+project.title,"undefined"!=typeof cfProgressBar&&(cfProgressBar.style.width="10%"),t.length>0&&t.insertAfter(divCanvasContainer),a.insertAfter(divCanvasContainer),n.insertAfter(divCanvasContainer),i.insertAfter(divCanvasContainer),r.insertAfter(divCanvasContainer),o.insertAfter(divCanvasContainer),BindDynamicAddedDOMEvents(),0==project.screensArray.length)return $("#emptyPlayback").show(),$("#divCanvasWrapper").hide(),$("#cfStudioLoader").fadeOut(),Offline.off("up"),Offline.off("down"),Offline.off("confirmed"),void Offline.off("checking");$("#emptyPlayback").hide(),$("#divCanvasWrapper").show(),divDeviceContainerWidth=divDeviceContainer.outerWidth(!0),divDeviceContainerHeight=divDeviceContainer.outerHeight(!0),divDeviceContainerPaddingTop=parseFloat(divDeviceContainer.css("padding-top")),divDeviceContainerPaddingBottom=parseFloat(divDeviceContainer.css("padding-bottom")),divDeviceContainerPaddingLeft=parseFloat(divDeviceContainer.css("padding-left")),divDeviceContainerPaddingRight=parseFloat(divDeviceContainer.css("padding-right")),ActivatePlaybackResponsiveness(!1);for(var d=0;d<project.screensArray.length;d++)addCanvasDOM(project.screensArray[d],d);RegisterScreenInteractions(),currentScreenId=project.screensArray[currentScreenIndex].id,playbackHistory=[],playbackHistoryPointer=-1,updatePlaybackHistory(),LoadPreviewScreen("",!0,0,function(){if(EnableVisibilityChange(),"function"==typeof e&&e(),"undefined"!=typeof cfProgressBar&&$("#cfStudioLoader").is(":visible")){cfProgressBar.style.width="100%";var a=$("#cfStudioLoader .loader-start");if(isRecordingEnabled)if($("#cfStudioLoader").hide(),"undefined"!=typeof referenceEmail&&referenceEmail.length>0)$("#useremail").val(referenceEmail),$("#cfStudioLoader .loader-start").length>0&&($("#cfStudioLoader .loader-start").trigger("click"),startRecording=!0);else{var t=$("#anonymousUserModal");t.length>0&&t.css("display","table").show()}else a.length>0?$("#cfStudioLoader .loader-start").trigger("click"):($("#cfStudioLoader").fadeOut(),Offline.off("up"),Offline.off("down"),Offline.off("confirmed"),Offline.off("checking"))}}),isRecordingEnabled&&divCanvasContainer.off("mousemove").on("mousemove",function(e){try{if(startRecording){var a=userJourneyInterval/10,t=!0;if(UserJourney.data.length>0&&a<=UserJourney.data[UserJourney.data.length-1][0]&&(t=!1),t){var n=divCanvasContainer.offset(),i=Math.floor((e.pageX-n.left-autoStretchOffsetLeft)/scaleFactor),r=Math.floor((e.pageY-n.top)/scaleFactor);UserJourney.data.push(new Array(a,currentScreenId,"",i,r,userTaskId)),isUserJourneyDirty=!0}}}catch(e){}})}function BindDynamicAddedDOMEvents(){if($("#playbackCommentInstructorBack").on("click",function(){$(".comment-marker").css("opacity","0.8"),$("#playbackCommentInstructorBack").hide(),$("#playbackCommentInstructorClose").show()}),$("#playbackCommentInstructorClose").on("click",function(){isMobile&&isMobile.any()?($(".comment-marker").css("opacity","0.8"),$("#chatHead").trigger("click")):$("li[data-option='comment']").trigger("click")}),$(".options-close").on("click",function(){closeModal("#optionsModal")}),$(".options-item").on("click",function(){var e=$(this).attr("data-option");switch(e){case"comment":ShowCommentMarkers(),chatHead.attr("data-mode","comment-mode");break;case"exit":break;case"restart":ReplayPlayback()}$(".options-close").trigger("click")}),"preview"==mode){var e=[{element:"#playbackSidebar li[data-option='comment'] svg",for:"playback",title:"View comments on prototype",description:"While you preview the prototype, check out all the comments on a particular screen.",pointer:"left",position:"right"},{element:"#playbackSidebar li[data-option='sitemap'] svg",for:"playback",title:"View Interaction map",description:"Get entire UX sitemap (interaction map) of the prototype. Print/download for reference.",pointer:"left",position:"right"},{element:"#playbackSidebar li[data-option='qrcode'] svg",for:"playback",title:"Access prototype with a QR code",description:"Wish to preview prototype on a mobile device? - Scan the QR code to get a mobile preview.",pointer:"left",position:"right"},{element:"#playbackSidebar li[data-option='restart'] svg",for:"playback",title:"Restart prototype.",description:"Preview the prototype from the first design screen all over again!",pointer:"left",position:"right"},{element:"#playbackSidebar li[data-option='edit'] svg",for:"playback",title:"Edit screen",description:"Found a faulty flow or a missing hotspot? Click open this screen in the build mode.",pointer:"left",position:"right"},{element:"#playbackSidebar li[data-option='share'] svg",for:"playback",title:"Share prototype",description:"Share prototype with real users, teammates and stakeholders for feedback and UX analytics.",pointer:"left",position:"right"},{element:"#playbackSidebar li[data-option='present'] svg",for:"playback",title:"Prototype preview mode",description:"Need to present a prototype at a meeting? Get a full screen preview mode of the prototype.",pointer:"left-bottom",position:"right"}];onboardingInit(e)}}function LoadPreviewScreen(e,a,t,n){DeactivateScreenTimer();var i=0;if(t){var r=$(".clsCanvas[data-index='"+currentScreenIndex+"']").data("scroll");i=void 0!=r?r.y:0}for(var o=null,s=0;s<project.screensArray.length;s++)if(project.screensArray[s].id==currentScreenId){o=project.screensArray[s],currentScreenIndex=s;break}document.title="CanvasFlip - "+o.Title;var d=$(".clsCanvas[data-index='"+currentScreenIndex+"']");if(d.length>0){d.css("opacity","1"),d.find(".anchorElement").each(function(){this.classList.remove("anchorElement"),this.offsetWidth=this.offsetWidth,this.classList.add("anchorElement")}),d.find(".layer-backdrop").removeClass("active").css("background-color","transparent"),d.find(".layerElement").removeClass("active");var r=d.data("scroll");r.scrollTo(0,i,0)}else addCanvasDOM(o,currentScreenIndex);RunScreenTransition(e,o,a,n)}function addCanvasDOM(e,a){var t=e.script.canvas,n="<div class='clsCanvas' data-id='"+e.id+"' data-index='"+a+"' style='opacity:1; height: "+deviceHeight+"px;'><div class='fixedHeader' style='height: "+t.header.h*scaleFactor+"px'><div class='fixedContainer fixedHeaderContainer' style='width: "+deviceWidth+"px;'><img class='fixedHeaderImage screenElement' src='"+screenResourcesURLPrefix+e.image+"' style='height: "+t.body.h*scaleFactor+"px;'></div></div><div class='fixedBody' style='height: "+(deviceHeight-(t.header.h+t.footer.h)*scaleFactor)+"px; top: "+t.header.h*scaleFactor+"px'><div class='fixedBodyWrapper' style='height: "+(t.body.h-t.footer.h)*scaleFactor+"px; top: -"+t.header.h*scaleFactor+"px'><div class='fixedContainer fixedBodyContainer' style='width: "+deviceWidth+"px;'><img class='fixedBodyImage screenElement' src='"+screenResourcesURLPrefix+e.image+"' style='height: "+t.body.h*scaleFactor+"px;'><div class='header-mask' style='top: 0px; width: 100%; height: "+t.header.h*scaleFactor+"px; position: absolute; background: rgb(223, 229, 233);'></div></div></div></div><div class='fixedFooter' style='height: "+t.footer.h*scaleFactor+"px'><div class='fixedContainer fixedFooterContainer' style='width: "+deviceWidth+"px;'><img class='fixedFooterImage screenElement' src='"+screenResourcesURLPrefix+e.image+"' style='height: "+t.body.h*scaleFactor+"px;'></div></div></div>";n=$(n);for(var i=n.find(".fixedHeader>div"),r=n.find(".fixedBody"),o=n.find(".fixedFooter>div"),s=0;s<t.anchors.length;s++){var d=t.anchors[s],c=parseInt(d.h*scaleFactor),l=parseInt(d.w*scaleFactor),v=parseInt(d.y*scaleFactor),p=parseInt(d.x*scaleFactor),f="<div class='anchorElement' data-type='anchor' data-id='"+d.id+"' data-gesture='"+d.ges+"' style='height:"+c+"px; width:"+l+"px; top:"+v+"px; left:"+p+"px;'></div>";if($(f).appendTo(r.find(".fixedContainer")),v<t.header.h*scaleFactor?$(f).appendTo(i):v+c>(t.body.h-t.footer.h)*scaleFactor&&$(f).css("top",v-(t.body.h-t.footer.h)*scaleFactor).appendTo(o),null!=d.layer){for(var c=parseInt(d.layer.h*scaleFactor),l=parseInt(d.layer.w*scaleFactor),v=parseInt(d.layer.y*scaleFactor),p=parseInt(d.layer.x*scaleFactor),h="<div class='layerElement' data-id='"+d.layer.id+"' data-transition='"+d.trans+"' data-backdrop='"+d.layer.back+"' style='height:"+c+"px; width:"+l+"px; top:"+v+"px; left: "+p+"px'><img class='layerImageElement' src='"+screenResourcesURLPrefix+d.layer.image+"'>",u=0;u<d.layer.anchors.length;u++){var m=d.layer.anchors[u],c=parseInt(m.h*scaleFactor),l=parseInt(m.w*scaleFactor),v=parseInt(m.y*scaleFactor),p=parseInt(m.x*scaleFactor);h+="<div class='anchorElement' data-type='anchor' data-id='"+m.id+"' data-gesture='"+m.ges+"' style='height:"+c+"px; width:"+l+"px; top:"+v+"px; left:"+p+"px;'></div>"}h+="</div>",n.append(h)}}for(var s=0;s<t.layers.length;s++){var c=parseInt(t.layers[s].h*scaleFactor),l=parseInt(t.layers[s].w*scaleFactor),v=parseInt(t.layers[s].y*scaleFactor),p=parseInt(t.layers[s].x*scaleFactor),h="<div class='layerElement' data-id='"+t.layers[s].id+"' data-transition='"+t.layers[s].trans+"' data-backdrop='"+t.layers[s].back+"' style='height:"+c+"px; width:"+l+"px; top:"+v+"px; left: "+p+"px'><img class='layerImageElement' src='"+screenResourcesURLPrefix+t.layers[s].image+"'></div>";n.append(h)}n.appendTo(divCanvasContainer),(isMobile.any()||playbackWrapper.hasClass("website"))&&(n.height(divCanvasWrapper.outerHeight()),r.height(n.height()-i.height()-o.height())),EnableFixedBodyPlaybackScroll(n,r),isRecordingEnabled&&RecordUserJourneyMeta(e,n)}function sanitizeCanvasDOM(e){try{var a=scaleFactor/lastScaleFactor;e.find(".screenElement").each(function(){var e=$(this);e.css({height:e.height()*a,top:parseFloat(e.css("top"))*a,left:parseFloat(e.css("left"))*a})}),e.find(".fixedContainer").each(function(){var e=$(this);e.css({width:e.width()*a})}),e.find(".layerElement").each(function(){var e=$(this);e.css({width:e.width()*a,height:e.height()*a,top:parseFloat(e.css("top"))*a,left:parseFloat(e.css("left"))*a})}),e.find(".anchorElement").each(function(){var e=$(this);e.css({width:e[0].getBoundingClientRect().width*a,height:e[0].getBoundingClientRect().height*a,top:parseFloat(e.css("top"))*a,left:parseFloat(e.css("left"))*a})});var t=e.find(".fixedBodyWrapper");t.css({height:t.height()*a,top:parseFloat(t.css("top"))*a,"-webkit-transform":"",transform:""});var n=e.find(".fixedBody"),i=e.find(".fixedHeader"),r=e.find(".fixedFooter");i.css({height:i.height()*a,top:0}),n.css({height:n.height()*a,top:parseFloat(n.css("top"))*a}),r.css({height:r.height()*a}),e.css({height:deviceHeight}),e.find(".layer-backdrop").removeClass("active").css("background-color","transparent"),e.find(".layerElement").removeClass("active"),e.find(".header-mask").height(n.css("top")),(isMobile.any()||playbackWrapper.hasClass("website"))&&(e.height(divCanvasWrapper.outerHeight()),n.height(e.height()-i.height()-r.height()),n.find(".fixedBodyWrapper").height(n.find(".fixedBodyImage").height()-r.height())),EnableFixedBodyPlaybackScroll(e,n)}catch(e){}}function EnableFixedBodyPlaybackScroll(e,a){if(a.length>0){var t=e.data("scroll");null!=t&&t.destroy();var n=new IScroll(a.get(0),{scrollbars:!0,mouseWheel:!0,fadeScrollbars:"undefined"==typeof divCanvasContainerHeader,interactiveScrollbars:!0,bounce:"undefined"==typeof divCanvasContainerHeader,resizeScrollbars:!0,keyBindings:!0,scrollX:!1,scrollY:!0});n.on("scrollStart",function(e){$(this.wrapper).addClass("scrolling")}),n.on("scrollEnd",function(e){if(this.moved||$(this.wrapper).removeClass("scrolling"),ignoreScrollEvent)return void(ignoreScrollEvent=!1);if(isRecordingEnabled&&startRecording){var a=Math.floor(this.x/scaleFactor),t=Math.floor(this.y/scaleFactor);BuildUserJourneyArray(userJourneyInterval/10,currentScreenId,"",a,t,0,0,"","","scroll","",userTaskId,0,0)}screensInteracted++}),e.data("scroll",n)}}function ResetAutoStretch(e){if("undefined"!=typeof divCanvasContainerHeader)try{var a=e.find(".fixedBodyImage");if(a.length>0){var t={"border-image-source":"url("+a.attr("src")+")","border-image-slice":"0 0 0 "+(a.get(0).naturalWidth-1)+" fill",height:a.height()+"px"};divCanvasContainerHeaderImage.css(t),divCanvasContainerFooterImage.css(t),e.find(".fixedBodyWrapper").css(t),divCanvasContainerHeader.height(e.find(".fixedHeader").height()),divCanvasContainerFooter.height(e.find(".fixedFooter").height()),autoStretchOffsetLeft=a.offset().left}}catch(e){}}function RunScreenTransition(e,a,t,n){var i=$(".clsCanvas.active"),r=$(".clsCanvas[data-index='"+currentScreenIndex+"']");e=null!=e?e:a.trans,isWeb&&isAutoStretch&&ResetAutoStretch(r),i.length>0?e&&e.length>0?(isAnimating=!1,doTransition(i,r,e)):(i.removeClass("active").css({opacity:0}),r.addClass("active").css({opacity:1})):r.addClass("active").css({opacity:1}),r.find(".fixedHeaderImage, .fixedBodyImage, .fixedFooterImage").each(function(){var e=$(this),a=e.attr("src");"gif"==a.substr(a.length-3,a.length).toLowerCase()&&e.attr("src",a)});var o=project.screensArray[currentScreenIndex].script.canvas.timer;t?(o.screen>0&&o.time>0&&ActivateScreenTimer(o),RunFirstScreenTransitionInit(function(){ActivatePlaybackResponsiveness(!1),"function"==typeof n&&n()})):(o.screen>0&&o.time>0&&ActivateScreenTimer(o),"function"==typeof n&&n())}function RegisterScreenInteractions(){$(divCanvasContainer).on("mouseover",".anchorElement",function(e){var a=$(this);if("hover"==a.attr("data-gesture")){var t=$("<div class='anchorElement active anchorElementHover' data-id='"+a.attr("data-id")+"' data-type='anchor' style='cursor:auto!important;background:none!important;border:none!important;"+a.attr("style")+"'></div>"),n=$.extend(!0,{},GetAnchorObject(a));n.sid=currentScreenId,n.ges="mouseleave";var i=a.offset(),r=a.height(),o=a.width();e.center={x:e.clientX,y:e.clientY};var s=ExecuteScreenInteraction("hover",e,null);switch(s){case"screen":var d=$(".clsCanvas.active");t.on("custom_mouseleave",function(e){t.remove(),e.center={x:e.clientX,y:e.clientY},ExecuteScreenInteraction("mouseleave",e,n)}),a.parents(".fixedBody").length>0?d.find(".fixedBodyContainer").prepend(t):a.parents(".fixedHeader").length>0?d.find(".fixedHeaderContainer").prepend(t):d.find(".fixedFooterContainer").prepend(t),d.on("mousemove",function(e){i.left<=e.clientX&&e.clientX<=i.left+o&&i.top<=e.clientY&&e.clientY<=i.top+r||(d.off("mousemove"),t.trigger("custom_mouseleave"))});break;case"layer":var c=$(".layerElement.active"),l=$(".layer-backdrop");c.on("mouseleave",function(e){a.off("mouseleave"),c.off("mouseleave"),l.trigger("click")})}}});var e=new Hammer.Manager(divCanvasContainer.get(0),{}),a=new Hammer.Pan({event:"pan",threshold:25,direction:Hammer.DIRECTION_ALL}),t=new Hammer.Press({event:"press"}),n=new Hammer.Tap({event:"tap"}),i=new Hammer.Tap({event:"doubletap",taps:2});e.add([i,n,a,t]),ignoreHammerEvent=!1,e.on("tap doubletap panleft panright panup pandown panstart panend press",function(e){var a=e.type;return"panstart"==a?void(ignoreHammerEvent=!0):"panend"==a?void(ignoreHammerEvent=!1):void(ignoreHammerEvent||ExecuteScreenInteraction(a,e,null))})}function GetAnchorObject(e){var a=project.screensArray[currentScreenIndex].script.canvas,t=e.attr("data-id"),n=null,i=null,r=null,o=e.parent(".layerElement");if(o.length>0){n=o.attr("data-id");for(var s=0;s<a.anchors.length;s++)if(null!=a.anchors[s].layer&&a.anchors[s].layer.id==n){r=a.anchors[s].layer;break}}if(null==r){for(var s=0;s<a.anchors.length;s++)if(a.anchors[s].id==t){i=a.anchors[s];break}}else for(var s=0;s<r.anchors.length;s++)if(r.anchors[s].id==t){i=r.anchors[s];break}return i}function ExecuteScreenInteraction(e,a,t){var n=$(a.target),i=n.offsetParent(),r="",o="",s="",d="",c=0,l=0,v=0,p=0;if(n.hasClass("anchorElement")&&(null==t&&(t=GetAnchorObject(n)),null!=t))if(s=t.ges,d=t.trans,v=t.s_maintain,p=t.s_smooth,null!=t.sid)r="screen",o=c=t.sid;else if(null!=t.layer)r="layer",o=l=t.layer.id;else if(null!=t.back)playbackHistoryPointer>0&&(r="screen",o=c=playbackHistory[playbackHistoryPointer-1],playbackHistoryPointer-=2,playbackHistory.splice(playbackHistoryPointer+1,playbackHistory.length));else if(null!=t.s_to){var f=parseFloat(t.s_to);r="scroll-to",o=c=isNaN(f)?0:f}var h=!1;if(""!=r&&n.hasClass("anchorElement"))switch(e){case"panleft":"swipeLeft"==s&&(h=!0);break;case"panright":"swipeRight"==s&&(h=!0);break;case"panup":"swipeUp"==s&&(h=!0);break;case"pandown":"swipeDown"==s&&(h=!0);break;case"hover":"hover"==s&&(v=1,h=!0);break;case"mouseleave":"mouseleave"==s&&(v=1,h=!0);break;case"doubletap":"doubleTap"==s&&(h=!0);break;case"tap":default:"tap"!=s&&""!=s||(h=!0)}if(n.hasClass("layer-backdrop")){var u=$(".clsCanvas[data-index='"+currentScreenIndex+"'] .layerElement.active");h=!0,r="screen",o=c=currentScreenId,d=u.attr("data-transition")}if("doubletap"==e&&!isCommentMode&&isRecordingEnabled&&UserJourney.data.length>1&&UserJourney.data.splice(UserJourney.data.length-1,UserJourney.data.length),!h){if(swipeNavigationEnabled){if("panleft"==e)return void swipeNavigate("right");if("panright"==e)return void swipeNavigate("left")}var m=n.parents(".clsCanvas"),y=m.find(".fixedBody");if(y.length>0&&y.hasClass("scrolling"))y.removeClass("scrolling");else if(isHintEnable&&!n.hasClass("layer-backdrop")){var g="webkitAnimationEnd oAnimationEnd MSAnimationEnd animationend";m.find(".anchorElement").each(function(){var e=$(this);e.off(g).css({"-webkit-animation-name":"","animation-name":""}),e.css({"-webkit-animation-name":"softAnchorBlink","animation-name":"softAnchorBlink"}),e.on(g,function(){e.off(g).css({"-webkit-animation-name":"","animation-name":""})})})}}if(h)!isCommentMode&&isRecordingEnabled&&startRecording&&CaptureUserBehaviour(a,e,n,i,o,r,d,v,p),ExecuteGesture(r,c,l,d,v,p),screensInteracted++;else if("press"==e)$("#chatHead").trigger("click");else{if(!isCommentMode&&isRecordingEnabled&&startRecording&&"panup"!=e&&"pandown"!=e){if(n.hasClass("layer-backdrop")){var C=m.find(".layerElement.active");C.length>0&&(d=C.attr("data-transition"))}CaptureUserBehaviour(a,e,n,i,o,r,d,v,p)}screensInteracted++}return r}function ExecuteGesture(e,a,t,n,i,r,o,s){previousScreenId=currentScreenId;var d=$(".clsCanvas[data-index='"+currentScreenIndex+"']");switch(d.find(".anchorElementHover").remove(),e){case"screen":if(a==currentScreenId){var c=d.find(".layerElement.active");c.length>0&&(d.find(".layer-backdrop").removeClass("active"),doElementTransition(c,"exit",n))}else{currentScreenId=a,updatePlaybackHistory();try{LoadPreviewScreen(n,!1,i,function(){"function"==typeof AfterLoadScreen&&AfterLoadScreen()})}catch(e){}}screensVisited.indexOf(a)<0&&screensVisited.push(a);break;case"layer":var c=d.find(".layerElement[data-id='"+t+"']"),l=c.attr("data-backdrop"),v="";switch(l){case"dark":v="rgba(0,0,0,0.5)";break;case"trans":v="rgba(0,0,0,0)";break;case"":v="rgba(0,0,0,0)";break;default:v=l}if(c.length>0){var p=d.find(".layer-backdrop");p.length>0?p.addClass("active").css("background-color",v):p=$("<div class='layer-backdrop active'></div>").appendTo(d),window.setTimeout(function(){p.css("background-color",v)},10),doElementTransition(c,"entry",n)}break;case"scroll":ignoreScrollEvent=!0,window.setTimeout(function(){ignoreScrollEvent=!1},800);var f=d.data("scroll");f.scrollTo(o*scaleFactor,s*scaleFactor,500);break;case"scroll-to":ignoreScrollEvent=!0,window.setTimeout(function(){ignoreScrollEvent=!1},800);var f=d.data("scroll"),h=d.find(".fixedBodyImage").height()-deviceHeight,u=a*scaleFactor,u=u>h?h:u;f.scrollTo(0,-u,500*r)}}function ActivatePlaybackResponsiveness(e){try{if($(document.body).css({"padding-top":playbackPadding.top,"padding-bottom":playbackPadding.bottom,"padding-left":playbackPadding.left,"padding-right":playbackPadding.right}),lastScaleFactor=scaleFactor,isMobile.any()||playbackWrapper.hasClass("website")){if(!playbackWrapper.hasClass("website")){var a=getOrientation();if(project.orientation!=a)return playbackMessage.fadeIn().find("> div").html("<h1>This project is designed for "+("Portrait"==a?"Landscape":"Portrait")+" mode.</h1><h2>Please rotate the device</h2>"),void playbackWrapper.fadeOut();playbackMessage.fadeOut(),playbackWrapper.fadeIn()}var t=parseFloat(window.innerWidth-playbackPadding.left-playbackPadding.right);if(deviceHeight=window.innerHeight-playbackPadding.top-playbackPadding.bottom,scaleFactor=parseFloat(t/projectWidth),isWeb){var n=$(".clsCanvas");if(n.length>0){var i=n.find(".fixedBodyImage");if(i.length>0){var r=i.first().get(0).naturalWidth,o=i.first().get(0).naturalHeight;t>r&&(scaleFactor=parseFloat(r/projectWidth)),deviceWidth>o&&(deviceHeight=o),e=!0,isAutoStretch&&ResetAutoStretch($(".clsCanvas[data-id='"+currentScreenId+"']"))}}else scaleFactor>1&&(scaleFactor=1)}deviceWidth=Math.floor(projectWidth*scaleFactor),divCanvasContainer.height(deviceHeight),isWeb&&isAutoStretch||divCanvasContainer.width(deviceWidth),e&&($(".clsCanvas").each(function(){sanitizeCanvasDOM($(this))}),isWeb&&isAutoStretch&&ResetAutoStretch($(".clsCanvas[data-id='"+currentScreenId+"']")))}else{var s=parseFloat((window.innerWidth-playbackPadding.left-playbackPadding.right)/divDeviceContainerWidth),d=parseFloat((window.innerHeight-playbackPadding.top-playbackPadding.bottom)/divDeviceContainerHeight),c=s<d?s:d;c>1&&(c=1),scaleFactor=c,deviceHeight=Math.floor(projectHeight*scaleFactor),deviceWidth=Math.floor(projectWidth*scaleFactor),divDeviceContainer.css({height:divDeviceContainerHeight*scaleFactor,width:divDeviceContainerWidth*scaleFactor,"padding-top":divDeviceContainerPaddingTop*scaleFactor,"padding-bottom":divDeviceContainerPaddingBottom*scaleFactor,"padding-left":divDeviceContainerPaddingLeft*scaleFactor,"padding-right":divDeviceContainerPaddingRight*scaleFactor}),e&&$(".clsCanvas").each(function(){sanitizeCanvasDOM($(this))})}}catch(e){}}function getOrientation(){switch(window.orientation+orientationOffset){case-90:case 90:case 270:return"Landscape";default:return"Portrait"}}function RunFirstScreenTransitionInit(e){"undefined"!=typeof runScreenTransitionInterval&&window.clearInterval(runScreenTransitionInterval);var a=$("#divCanvas").length>0?$("#divCanvas"):$(".clsCanvas"),t=a.find("img"),n=a.find(".fixedBodyImage");runScreenTransitionInterval=window.setInterval(function(){RunScreenTransitionConfirm(t,t.length,n,n.length,e)},500)}function RunScreenTransitionConfirm(e,a,t,n,i){if(e.filter(function(){return this.complete}).length===a)$("#bodySpinner").hide(),"undefined"!=typeof runScreenTransitionInterval&&window.clearInterval(runScreenTransitionInterval),"function"==typeof i&&i(),playbackInitConfirmed=!0;else if(null!=t){try{var r=t.filter(function(){return this.complete}).length;cfProgressBar.style.width=r/n*90+10+"%","undefined"!=cfProgressTitle&&(cfProgressTitle.innerText=r+" of "+n+" screens downloaded")}catch(e){}$("#bodySpinner").show()}}function EnableVisibilityChange(){var e,a;"undefined"!=typeof document.hidden?(e="hidden",a="visibilitychange"):"undefined"!=typeof document.mozHidden?(e="mozHidden",a="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(e="msHidden",a="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(e="webkitHidden",a="webkitvisibilitychange"),"undefined"!=typeof document.addEventListener&&"undefined"!=typeof document[e]&&(userJourneyInterval=0,document.addEventListener(a,HandleVisibilityChange,!1)),HandleVisibilityChange()}function HandleVisibilityChange(){isTaskModalOpen="undefined"!=typeof taskModal&&taskModal.hasClass("active"),document.hidden||isTaskModalOpen?(window.clearInterval(userJourneyIntervalID),userJourneyIntervalID=0):(window.clearInterval(userJourneyIntervalID),userJourneyIntervalID=0,userJourneyIntervalID=window.setInterval(function(){isCommentMode||userJourneyInterval++},100))}function ReplayPlayback(e){$(".clsCanvas").removeClass("active"),$(".clsCanvas[data-index='"+currentScreenIndex+"']").addClass("active"),currentScreenIndex=0,DeactivateScreenTimer(),currentScreenId=project.screensArray[0].id,updatePlaybackHistory(),LoadPreviewScreen("",!1,0,e)}function ShowCommentMarkers(){isCommentMode=!0;var e=$("#playbackComment");if(e.html("<div><div><img src='"+screenResourcesURLPrefix+project.screensArray[currentScreenIndex].image+"'></div></div>"),e.find(">div>div").css("width",deviceWidth),"undefined"!=typeof divCanvasContainerHeader&&isAutoStretch)try{var a=$(".clsCanvas[data-id='"+currentScreenId+"']"),t=a.find(".fixedBodyImage");if(t.length>0){var n={"border-image-source":"url("+t.attr("src")+")","border-image-slice":"0 0 0 "+(t.get(0).naturalWidth-1)+" fill",height:t.height()+"px"};e.find(">div").css(n)}}catch(e){}e.addClass("active"),Comment.renderCommentMarkers(e.find(">div>div"),currentScreenIndex),new IScroll(e.get(0),{scrollbars:!0,mouseWheel:!0,fadeScrollbars:!1,interactiveScrollbars:!0,resizeScrollbars:!0,keyBindings:!0,scrollX:!1,scrollY:!0}),$("#playbackCommentInstructor").addClass("active"),divCanvasContainer.find(".comment-marker").show(),divCanvasContainer.find(".anchorElement").hide(),divCanvasContainer.addClass("comments-mode"),divCanvasContainer.on("mousemove",function(e){createCommentMarkerDOM.css({top:e.pageY-12,left:e.pageX+20,display:"block"})})}function HideCommentMarkers(){isCommentMode=!1,$("#playbackComment").removeClass("active").empty(),$("#playbackCommentInstructor").removeClass("active"),divCanvasContainer.off("mousemove"),divCanvasContainer.removeClass("comments-mode"),divCanvasContainer.find(".comment-marker").hide(),divCanvasContainer.find(".anchorElement").show(),createCommentMarkerDOM.hide(),isCommentEnabled&&Comment.closeCommentBox()}function ActivateScreenTimer(e){if(!isPlaybackPlayer){var a=1e3*parseFloat(e.time);$(".clsCanvas[data-id='"+e.screen+"']").length>0&&(DeactivateScreenTimer(),activeScreenTimer=window.setInterval(function(){isRecordingEnabled&&startRecording&&BuildUserJourneyArray(userJourneyInterval/10,currentScreenId,"",0,0,0,0,e.screen,e.trans,"screen",4,userTaskId,0,0),currentScreenId=e.screen,updatePlaybackHistory(),LoadPreviewScreen(e.trans,!1,0,function(){"function"==typeof AfterLoadScreen&&AfterLoadScreen()}),screensVisited.indexOf(e.screen)<0&&screensVisited.push(e.screen),screensInteracted++},a))}}function DeactivateScreenTimer(){"undefined"!=typeof activeScreenTimer&&null!=activeScreenTimer&&(window.clearInterval(activeScreenTimer),activeScreenTimer=null)}function updatePlaybackHistory(){isUserInteraction=!0,playbackHistoryPointer++,playbackHistory.splice(playbackHistoryPointer,playbackHistory.length),playbackHistory.push(parseInt(currentScreenId)),window.location.hash=currentScreenId}function swipeNavigate(e){isUserInteraction=!1;var a="",t=0,n=$("#divCanvasContainer > .clsCanvas").length,i=$(".playback-screen-count");i.find(".total-screens").text(parseInt(n)),"left"===e?(a=$("#divCanvasContainer .clsCanvas.active").prev().attr("data-id"),t=parseInt($("#divCanvasContainer .clsCanvas.active").prev().attr("data-index")),void 0!==a?(window.location.hash=a,i.is(":visible")||i.fadeIn(),i.find(".remaining-screens").text(t+1),setTimeout(function(){i.fadeOut("fast")},1e3)):(a=$("#divCanvasContainer .clsCanvas:last").attr("data-id"),t=parseInt($("#divCanvasContainer .clsCanvas:last").attr("data-index")),window.location.hash=a,i.is(":visible")||i.fadeIn(),i.find(".remaining-screens").text(t+1),i.find(".screen-title").text(screenTitle),setTimeout(function(){i.fadeOut("fast")},1e3))):(a=$("#divCanvasContainer .clsCanvas.active").next().attr("data-id"),t=parseInt($("#divCanvasContainer .clsCanvas.active").next().attr("data-index")),void 0!==a?(window.location.hash=a,i.is(":visible")||i.fadeIn(),i.find(".remaining-screens").text(t+1),
setTimeout(function(){i.fadeOut("fast")},1e3)):(a=$("#divCanvasContainer .clsCanvas:first").attr("data-id"),t=parseInt($("#divCanvasContainer .clsCanvas:first").attr("data-index")),window.location.hash=a,i.is(":visible")||i.fadeIn(),i.find(".remaining-screens").text(t+1),i.find(".screen-title").text(screenTitle),setTimeout(function(){i.fadeOut("fast")},1e3)))}function getOrdinal(e){var a=["th","st","nd","rd"],t=e%100;return e+(a[(t-20)%10]||a[t]||a[0])}function openModal(e){$(e).addClass("active"),$("body").addClass("modal-open")}function closeModal(e){$(e).removeClass("active"),$("body").removeClass("modal-open")}function inIframe(){try{return window.self!==window.top}catch(e){return!0}}playbackHistory=[],playbackHistoryPointer=-1,isUserInteraction=!1,ignoreHammerEvent=!1,ignoreScrollEvent=!1,orientationOffset=0,mode="playback",isInteractionModeActive=!1,isWeb=!1,autoStretchOffsetLeft=0,playbackInitConfirmed=!1,window.onhashchange=function(e){if(isUserInteraction)isUserInteraction=!1;else{var a=parseInt(window.location.hash.replace("#","")),t=!1;playbackHistory[playbackHistoryPointer-1]==a?(playbackHistoryPointer--,t=!0):playbackHistory[playbackHistoryPointer+1]==a?(playbackHistoryPointer++,t=!0):currentScreenId!=a&&(t=!0),t&&(isRecordingEnabled&&startRecording&&BuildUserJourneyArray(userJourneyInterval/10,currentScreenId,"",0,0,0,0,a,"","screen",4,userTaskId,0,0),currentScreenId=a,LoadPreviewScreen(null,!1,0,function(){"function"==typeof AfterLoadScreen&&AfterLoadScreen()}),screensVisited.indexOf(a)<0&&screensVisited.push(a),screensInteracted++)}},function(e){e.fn.draggable=function(a){if(a=e.extend({handle:"",cursor:"move",dragDelay:300},a),""===a.handle)var t=this;else var t=this.find(a.handle);var n=0;return t.css("cursor",a.cursor).on("mousedown",function(t){if(n=t.timeStamp,""===a.handle)var i=e(this).addClass("draggable");else var i=e(this).addClass("active-handle").parent().addClass("draggable");var r=i.outerHeight(),o=i.outerWidth(),s=i.offset().top+r-t.pageY,d=i.offset().left+o-t.pageX;i.parents().on("mousemove",function(a){e(".draggable").offset({top:a.pageY+s-r,left:a.pageX+d-o}).on("mouseup",function(){e(this).removeClass("draggable")})}),t.preventDefault(),t.stopPropagation()}).on("mouseup",function(t){""===a.handle?e(this).removeClass("draggable"):e(this).removeClass("active-handle").parent().removeClass("draggable"),t.timeStamp-n<=a.dragDelay||"function"==typeof a.stop&&a.stop(this)})},e(document.body).on("keyup",function(e){if(39==e.which||37==e.which)switch(e.which){case 37:swipeNavigate("left");break;case 39:swipeNavigate("right")}})}(jQuery);